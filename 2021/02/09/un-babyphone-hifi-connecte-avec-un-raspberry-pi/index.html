<!DOCTYPE html>
<html lang="fr">
<head>
	<link rel="preconnect" href="https://www.google-analytics.com" crossorigin>
	<script async src="https://www.googletagmanager.com/gtag/js?id=UA-138276383-2"></script>
	<script>
		window.dataLayer = window.dataLayer || [];
		function gtag(){dataLayer.push(arguments);}
		gtag('js', new Date());
		gtag('config', 'UA-138276383-2');
	</script>
	<meta charset="utf-8" />
	<meta name="description" content="Mise en place d'une radio avec Icecast et ffmpeg sous Raspbian Buster.">
	<meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1">
	<meta name="msapplication-TileColor" content="#da532c">
	<meta name="theme-color" content="#ffffff">
	<title>Geoffrey Guéret - Un babyphone HiFi connecté avec un Raspberry Pi</title>
	<!--[if lt IE 9]><script src="http://html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
		<link rel="stylesheet" href="https://geoffrey.gueret.org/theme/style.min.css?a0cbbd20" />
	<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
	<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
	<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
	<link rel="manifest" href="/site.webmanifest">


	<link rel="canonical" href="https://geoffrey.gueret.org/2021/02/09/un-babyphone-hifi-connecte-avec-un-raspberry-pi/">
</head>
<body role="document">
	<div id="page">
		<header id="header">
			<div class="container">
				<h1><a href="https://geoffrey.gueret.org/">Geoffrey Guéret <strong></strong></a></h1>
				<p id="sentence" class="text-muted">&#127839;&amp; <span id="buzzword">tech</span></p>
				<nav role="navigation">
					<ul>
						<li><a class="active" href="https://geoffrey.gueret.org/" title="blog posts">Blog</a></li>
						<li><a href="https://geoffrey.gueret.org/about/">A propos</a></li>
						<li><a href="https://geoffrey.gueret.org/projects/">Projets</a></li>
					</ul>
				</nav>
			</div>
		</header>
		<div id="main" role="main">
<div class="container">
	<article role="article">
		<header>
			<h1><a href="https://geoffrey.gueret.org/2021/02/09/un-babyphone-hifi-connecte-avec-un-raspberry-pi/">Un babyphone HiFi connecté avec un Raspberry Pi</a></h1><!--
			--><time datetime="2021-02-09T20:39:00+01:00">Le Mar 09 février 2021</time><!--
			--><p class="category">DIY</p>
		</header>
		<div class="content">
			<p>Je ne suis pas adepte des nouveaux dispositifs qui sont ultra connectés, parce que je ne sais pas où transitent mes données et à plus forte raison quand ça concerne mon enfant.
Il me fallait donc mettre en place une solution que je puisse appréhender dans son ensemble : Un micro connecté, diffusé à travers mon réseau local.</p>
<p>Le <a href="https://www.raspberrypi.org/products/raspberry-pi-3-model-b-plus/">Raspberry Pi 3 Model B+</a> est un bon candidat pour environ 80€ on a un <a href="https://www.kubii.fr/kits-raspberry-pi-3-et-3/2121-starter-kit-officiel-pi-3-b-kubii-3272496009998.html">pack complet avec une carte SD de 16Go</a>, c'est largement suffisant. Il faut ajouter un microphone, par exemple un micro à pince USB pour environ 10 €. A noter que plus sa sensiblité <em>(exprimée en dB)</em> sera elevée et plus sa zone de capture sera large.</p>
<p>Coté système de capture, les besoins sont essentiellements :</p>
<ul>
<li>de pouvoir faire de l'acquisition, via une prise JACK ou une carte externe</li>
<li>de transcoder un flux audio avec peu de latence et si possible en de multiples formats</li>
<li>de pouvoir diffuser ces flux à au moins 3 périphériques en simultanés</li>
</ul>
<p>Coté écoute, 3 types d'appareils :</p>
<ul>
<li>Une Sonos ‎SYMFONISK</li>
<li>Une Google Chromecast Ultra</li>
<li>Le <a href="https://www.videolan.org/vlc/">VLC media player</a>, qui à l'avantage d'être multi-plateformes</li>
</ul>
<p>Dans le cas des deux en tête de liste, les librairies Python <a href="https://github.com/SoCo/SoCo">SoCo</a> et <a href="https://github.com/home-assistant-libs/pychromecast">pychromecast</a> permettent de lancer la lecture depuis une webradio. VLC gère nativement la lecture des flux réseau. Au niveau des formats, ils gèrent tous le codec Vorbis en mode débit binaire variable. Bonne nouvelle puisque ce codec assure une bonne restition sonore comparé au mp3, il est OSS et notamment utilisé par Spotify.</p>
<p>Configuration du Raspberry Pi</p>
<div class="highlight"><pre><span></span><code><span class="nv">XKBMODEL</span><span class="o">=</span><span class="s2">&quot;pc105&quot;</span>  <span class="c1"># Generic 105-key PC (intl.)</span>
<span class="nv">XKBLAYOUT</span><span class="o">=</span><span class="s2">&quot;fr&quot;</span>    <span class="c1"># French</span>
<span class="nv">XKBVARIANT</span><span class="o">=</span><span class="s2">&quot;mac&quot;</span>  <span class="c1"># French (Macintosh)</span>
</code></pre></div>


<h2 id="transcoder-et-diffuser-plusieurs-flux-en-simultane">Transcoder et diffuser plusieurs flux en simultané<a class="headerlink" href="#transcoder-et-diffuser-plusieurs-flux-en-simultane" title="Permanent link"></a></h2>
<div class="highlight"><pre><span></span><code>ffmpeg -f alsa -i hw:1,0 <span class="se">\</span>
    -map <span class="m">0</span>:0 -c:a aac -f adts -content_type <span class="s2">&quot;audio/aac&quot;</span> -ab 128k icecast://source:&lt;password&gt;@127.0.0.1:8000/matteo.aac <span class="se">\</span>
    -map <span class="m">0</span>:0 -c:a flac -f ogg -content_type <span class="s2">&quot;application/ogg&quot;</span> -compression_level <span class="m">10</span> icecast://source:&lt;password&gt;@127.0.0.1:8000/matteo.flac.ogg <span class="se">\</span>
    -map <span class="m">0</span>:0 -c:a libmp3lame -f mp3 -content_type <span class="s2">&quot;audio/mp3&quot;</span> -qscale:a <span class="m">10</span> icecast://source:&lt;password&gt;@127.0.0.1:8000/matteo.mp3 <span class="se">\</span>
    -map <span class="m">0</span>:0 -c:a libvorbis -f ogg -content_type <span class="s2">&quot;application/ogg&quot;</span> -qscale:a <span class="m">10</span> icecast://source:&lt;password&gt;@127.0.0.1:8000/matteo.vorbis.ogg <span class="se">\</span>
    -map <span class="m">0</span>:0 -c:a libopus -f ogg -content_type <span class="s2">&quot;application/ogg&quot;</span> -ab 128k -compression_level <span class="m">10</span> -application lowdelay icecast://source:&lt;password&gt;@127.0.0.1:8000/matteo.opus.ogg
</code></pre></div>
		</div>
	</article>
</div>
		</div>
		<footer id="footer" role="contentinfo">
			<p><small>&copy; Copyright 2021 - Geoffrey Guéret<br>Contenu généré avec <a href="https://blog.getpelican.com/">Pelican</a> et hébergé sur <a href="https://pages.github.com/">GitHub Pages</a></small></p>
			<div class="social-icons">
				<span><a href="https://github.com/ggueret" title="GitHub"><svg style="fill: #333;" role="img" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><title>GitHub</title><path d="M12 .297c-6.63 0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577 0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93 0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176 0 0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22 0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22 0 1.606-.015 2.896-.015 3.286 0 .315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12"/></svg></a></span>
				<span><a href="https://www.linkedin.com/in/ggueret/" title="LinkedIn"><svg width="32" height="32" style="fill: #4875B4;" role="img" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><title>LinkedIn</title><path d="M20.447 20.452h-3.554v-5.569c0-1.328-.027-3.037-1.852-3.037-1.853 0-2.136 1.445-2.136 2.939v5.667H9.351V9h3.414v1.561h.046c.477-.9 1.637-1.85 3.37-1.85 3.601 0 4.267 2.37 4.267 5.455v6.286zM5.337 7.433c-1.144 0-2.063-.926-2.063-2.065 0-1.138.92-2.063 2.063-2.063 1.14 0 2.064.925 2.064 2.063 0 1.139-.925 2.065-2.064 2.065zm1.782 13.019H3.555V9h3.564v11.452zM22.225 0H1.771C.792 0 0 .774 0 1.729v20.542C0 23.227.792 24 1.771 24h20.451C23.2 24 24 23.227 24 22.271V1.729C24 .774 23.2 0 22.222 0h.003z"/></svg></a></span>
				<span><a href="https://www.malt.fr/profile/geoffreygueret" title="Malt"><svg width="32" height="32" style="fill: #ff396c;" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 92.3 92.3"><path d="M79 14.2c-4.6-4.5-12-4.5-16.4 0L13.4 62.8C9 67.3 9 74.6 13.4 79c4.4 4.5 11.7 4.5 16.2 0l49-48.6c4.7-4.6 4.7-12 .3-16.4"></path><path d="M57.6 12.3C57.6 4.5 52.6 0 46 0 40 0 34.7 6 34.6 12.3L46 24l11.6-11.7z"></path><path d="M30.5 13.8c-2-2.2-5-3.5-8-3.5-3.2 0-6 1-8.3 3.2-4.6 4.4-4.7 11.7-.4 16.3l1.7 1.8h24.3l4-3.8-13.3-14z"></path><path d="M11.6 35c-3 0-6 1.3-8.2 3.4-2.2 2.2-3.4 5-3.4 8 0 3.2.6 11.7 13.2 11.7l23-22.8H11.7z"></path><path d="M34.6 80c0 7.8 5 12.3 11.5 12.3 6.4 0 11.6-6 11.7-12.3L46 68.3 34.6 80z"></path><path d="M78.4 63.7L76.7 62l-24.3-.2-4 4L62 79.5c4.4 4.6 11.7 4.7 16.3.4 4.6-4.4 4.7-11.7.4-16.3"></path><path d="M79.2 35.3L56 58.3h24.6c3.2 0 6-1 8.2-3.2 2.2-2 3.4-5 3.4-8 0-6.4-5-11.8-13-11.7"></path></svg></a></span>
			</div>
		</footer>
	</div>
	<script type="text/javascript" src="https://geoffrey.gueret.org/theme/main.min.js?37e8eae4"></script>
	<script src="https://cdn.jsdelivr.net/npm/typed.js@2.0.9"></script>
</body>
</html>